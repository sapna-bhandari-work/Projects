import socket 
from IPy import IP
import threading

# List to store open ports found during scanning
ports = []

# List to store service banners collected from open ports
banners = []


def port_scanner(target, port):
    """
    Attempts to connect to a specific port on the target.
    If successful, grabs the service banner and stores it.
    """
    try:
        # Create a TCP socket
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        # Set timeout to avoid hanging on closed/filtered ports
        s.settimeout(5)

        try:
            # If target is an IP address
            trarget_ip = IP(target)
        except:
            # If target is a domain name, resolve it to IP
            target_ip = socket.gethostbyname(target)

        # Attempt to connect to the target port
        s.connect((target_ip, port))

        try:
            # Grab banner from the open port
            banner_name = banner(s).decode()

            # Store the open port and its banner
            ports.append(port)
            banners.append(banner_name.strip())
        except:
            # Some services do not return banners
            pass

        # Close the socket after use (approved change)
        s.close()

    except:
        # Ignore ports that are closed or unreachable
        pass


def banner(s):
    """
    Receives and returns banner data from the connected service.
    """
    return s.recv(1024)


# Take target input from the user
target = input("Enter Target IP address, localhost or www.domainname.com : ")

# Take number of ports to scan
portsc = int(input("Enter Number of ports to be scanned"))

# Start scanning ports using multithreading
for port in range(1, portsc):
    thread = threading.Thread(target=port_scanner, args=[target, port])
    thread.start()

# Open vulnerable banner database file
with open("vulnarable_banners.txt", "r") as file:
    data = file.read()

    # Compare collected banners with known vulnerable banners
    for i in range(len(banners)):
        if banners[i] in data:
            print(f"[!]Vulneribility found: {banners[i]} at port {ports[i]}")
